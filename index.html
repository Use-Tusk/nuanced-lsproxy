<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Clone API Tester</title>
    <script>
        async function cloneRepo() {
            const id = document.getElementById('id').value;
            const githubUrl = document.getElementById('githubUrl').value;
            const reference = document.getElementById('reference').value;

            const response = await fetch('http://localhost:8080/clone', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    id: id,
                    github_url: githubUrl,
                    reference: reference || undefined,
                }),
            });

            const result = await response.text();
            document.getElementById('result').textContent = result;
        }

        async function listRepos() {
            const response = await fetch('http://localhost:8080/list');
            const repos = await response.json();
            const repoList = repos.map(repo => 
                `ID: ${repo.id}\nURL: ${repo.github_url}\nBranch: ${repo.branch || 'N/A'}\nCommit: ${repo.commit}\nTemp Dir: ${repo.temp_dir}`
            ).join('\n\n');
            document.getElementById('repoList').textContent = repoList;
        }

        async function initLsp() {
            const id = document.getElementById('lspId').value;
            const githubUrl = document.getElementById('lspGithubUrl').value;

            const response = await fetch('http://localhost:8080/init-lsp', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    id: id,
                    github_url: githubUrl,
                }),
            });

            const result = await response.text();
            document.getElementById('lspResult').textContent = result;
        }

        async function getFunctionDefinition() {
            const id = document.getElementById('funcDefId').value;
            const githubUrl = document.getElementById('funcDefGithubUrl').value;
            const filePath = document.getElementById('funcDefFilePath').value;
            const line = parseInt(document.getElementById('funcDefLine').value);
            const character = parseInt(document.getElementById('funcDefCharacter').value);

            const response = await fetch('http://localhost:8080/function-definition', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    id: id,
                    github_url: githubUrl,
                    file_path: filePath,
                    line: line,
                    character: character,
                }),
            });

            const result = await response.text();
            document.getElementById('funcDefResult').textContent = result;
        }
    </script>
</head>
<body>
    <h1>GitHub Clone API Tester</h1>
    <form onsubmit="event.preventDefault(); cloneRepo();">
        <label for="id">ID:</label>
        <input type="text" id="id" required><br><br>
        
        <label for="githubUrl">GitHub URL:</label>
        <input type="text" id="githubUrl" required><br><br>
        
        <label for="reference">Reference (optional):</label>
        <input type="text" id="reference"><br><br>
        
        <button type="submit">Clone Repository</button>
    </form>
    <div id="result"></div>
    <br>
    <button onclick="listRepos()">List Repositories</button>
    <pre id="repoList"></pre>
    <br>
    <h2>Initialize LSP</h2>
    <form onsubmit="event.preventDefault(); initLsp();">
        <label for="lspId">ID:</label>
        <input type="text" id="lspId" required><br><br>
        
        <label for="lspGithubUrl">GitHub URL:</label>
        <input type="text" id="lspGithubUrl" required><br><br>
        
        <button type="submit">Initialize LSP</button>
    </form>
    <div id="lspResult"></div>
    <br>
    <h2>Get Function Definition</h2>
    <form onsubmit="event.preventDefault(); getFunctionDefinition();">
        <label for="funcDefId">ID:</label>
        <input type="text" id="funcDefId" required><br><br>
        
        <label for="funcDefGithubUrl">GitHub URL:</label>
        <input type="text" id="funcDefGithubUrl" required><br><br>
        
        <label for="funcDefFilePath">File Path:</label>
        <input type="text" id="funcDefFilePath" required><br><br>
        
        <label for="funcDefLine">Line:</label>
        <input type="number" id="funcDefLine" required><br><br>
        
        <label for="funcDefCharacter">Character:</label>
        <input type="number" id="funcDefCharacter" required><br><br>
        
        <button type="submit">Get Function Definition</button>
    </form>
    <div id="funcDefResult"></div>

    <h2>List LSP Servers</h2>
    <button onclick="listLspServers()">List LSP Servers</button>
    <pre id="lspServerList"></pre>

    <h2>Get Document Symbols</h2>
    <form onsubmit="event.preventDefault(); getDocumentSymbols();">
        <label for="symbolId">ID:</label>
        <input type="text" id="symbolId" required><br><br>
        
        <label for="symbolGithubUrl">GitHub URL:</label>
        <input type="text" id="symbolGithubUrl" required><br><br>
        
        <label for="symbolFilePath">File Path:</label>
        <input type="text" id="symbolFilePath" required><br><br>
        
        <button type="submit">Get Document Symbols</button>
    </form>
    <pre id="symbolResult"></pre>

    <script>
        async function listLspServers() {
            const response = await fetch('http://localhost:8080/list-lsp');
            const servers = await response.json();
            const serverList = servers.join('\n');
            document.getElementById('lspServerList').textContent = serverList;
        }

        async function getDocumentSymbols() {
            const id = document.getElementById('symbolId').value;
            const githubUrl = document.getElementById('symbolGithubUrl').value;
            const filePath = document.getElementById('symbolFilePath').value;

            const response = await fetch('http://localhost:8080/document-symbols', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    id: id,
                    github_url: githubUrl,
                    file_path: filePath,
                }),
            });

            const result = await response.json();
            document.getElementById('symbolResult').textContent = JSON.stringify(result, null, 2);
        }
    </script>
</body>
</html>
